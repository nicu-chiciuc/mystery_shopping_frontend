<md-content layout-padding>

  <h2>{{ questionnaire.title }}</h2>
  <md-content layout-padding>
    {{ questionnaire.description }}
  </md-content>

  <div class="questionnaire" layout-padding>

    <!--
    Level 1 blocks
    -->
    <md-whiteframe dragula="'block-1'"
                   dragula-model="questionnaire.template_blocks"
                   class="md-whiteframe-2dp">

      <!-- Content container for each top level block -->
      <md-content ng-repeat="block_1 in questionnaire.template_blocks"
                  flex="100">

        <!-- Block header -->
        <md-toolbar flex="100" class="ms-height-md">

          <!-- Header wrapper -->
          <h2 class="md-toolbar-tools handle-1" layout-align="left center" layout="row">

            <!-- Block title -->
            <span>
              {{ block_1.title }}
            </span>

            <!-- Edit button -->
            <md-button ng-click="vm.showEditBlockTitleDialog($event, block_1, questionnaire)"
                       class="md-icon-button">
              <ng-md-icon icon="edit" size="18"
                          aria-label="{{ 'QUESTIONNAIRE.DIALOG.EDIT_BLOCK_TITLE' | translate }}">
              </ng-md-icon>
            </md-button>

            <!-- Empty span element to fill in the width of block header -->
            <span flex></span>

            <!-- Block weight -->
            <span>
              {{ ('QUESTIONNAIRE.BLOCK.WEIGHT' | translate) + ': ' + block_1.weight }}
            </span>
          </h2>
        </md-toolbar>

        <!-- Block content container -->
        <md-content flex="100" layout="column" layout-padding>

          <!-- Block questions -->
          <div ng-repeat="question in block_1.template_questions">
            <ms-questionnaire-generic-question question="question"></ms-questionnaire-generic-question>
            <md-divider></md-divider>
          </div>

          <!--
          Level 2 blocks
          -->
          <md-whiteframe dragula="'block-2'"
                         dragula-model="block_1.template_blocks"
                         class="md-whiteframe-2dp">

            <!-- Content container for each top level block -->
            <md-content ng-repeat="block_2 in block_1.template_blocks"
                        flex="100">

              <!-- Block header -->
              <md-toolbar flex="100" class="ms-height-sm">

                <!-- Header wrapper -->
                <h2 class="md-toolbar-tools handle-2">

                  <!-- Block title -->
                  <span>
                    {{ block_2.title }}
                  </span>

                  <!-- Edit button -->
                  <md-button ng-click="vm.showEditBlockTitleDialog($event, block_2, block_1)"
                             class="md-icon-button">
                    <ng-md-icon icon="edit" size="18"
                                aria-label="{{ 'QUESTIONNAIRE.DIALOG.EDIT_BLOCK_TITLE' | translate }}">
                    </ng-md-icon>
                  </md-button>

                  <!-- Empty span element to fill in the width of block header -->
                  <span flex></span>

                  <!-- Block weight -->
                  <span>
                    {{ ('QUESTIONNAIRE.BLOCK.WEIGHT' | translate) + ': ' + block_2.weight }}
                  </span>
                </h2>
              </md-toolbar>

              <!-- Block content container -->
              <md-content flex="100" layout="column" layout-padding>

                <!-- Block questions -->
                <div ng-repeat="question in block_2.template_questions">
                  <ms-questionnaire-generic-question question="question"></ms-questionnaire-generic-question>
                  <md-divider></md-divider>
                </div>

                <!--
                Level 3 blocks
                -->
                <md-whiteframe dragula="'block-3'"
                               dragula-model="block_2.template_blocks"
                               class="md-whiteframe-2dp">

                  <!-- Content container for each top level block -->
                  <md-content ng-repeat="block_3 in block_2.template_blocks"
                              flex="100">

                    <!-- Block header -->
                    <md-toolbar flex="100" class="ms-height-sm">

                      <!-- Header wrapper -->
                      <h2 class="md-toolbar-tools handle-3">

                        <!-- Block title -->
                        <span>
                          {{ block_3.title }}
                        </span>

                        <!-- Edit button -->
                        <md-button ng-click="vm.showEditBlockTitleDialog($event, block_3, block_2)"
                                   class="md-icon-button">
                          <ng-md-icon icon="edit" size="18"
                                      aria-label="{{ 'QUESTIONNAIRE.DIALOG.EDIT_BLOCK_TITLE' | translate }}">
                          </ng-md-icon>
                        </md-button>

                        <!-- Empty span element to fill in the width of block header -->
                        <span flex></span>

                        <!-- Block weight -->
                        <span>
                          {{ ('QUESTIONNAIRE.BLOCK.WEIGHT' | translate) + ': ' + block_3.weight }}
                        </span>
                      </h2>
                    </md-toolbar>

                    <!-- Block content container -->
                    <md-content flex="100" layout-padding>

                      <!-- Block questions -->
                      <div ng-repeat="question in block_3.template_questions">
                        <ms-questionnaire-generic-question question="question"></ms-questionnaire-generic-question>
                        <md-divider></md-divider>
                      </div>

                    </md-content>

                    <section layout="row">
                      <span flex></span>
                      <md-button ng-click="vm.showAddQuestionDialog($event, block_3)"
                                 class="md-fab md-mini md-primary"
                                 aria-label="{{ 'QUESTIONNAIRE.ACTIONS.ADD_QUESTION' | translate }}">
                        <ng-md-icon icon="playlist_add"></ng-md-icon>

                        <!-- Tooltip -->
                        <md-tooltip md-direction="top">
                          {{ 'QUESTIONNAIRE.ACTIONS.ADD_QUESTION' | translate }}
                        </md-tooltip>
                      </md-button>
                    </section>

                  </md-content>

                </md-whiteframe>

              </md-content>

              <section layout="row">
                <span flex></span>
                <md-button ng-click="vm.showAddQuestionDialog($event, block_2)"
                           class="md-fab md-mini md-primary"
                           aria-label="{{ 'QUESTIONNAIRE.ACTIONS.ADD_QUESTION' | translate }}">
                  <ng-md-icon icon="playlist_add"></ng-md-icon>

                  <!-- Tooltip -->
                  <md-tooltip md-direction="top">
                    {{ 'QUESTIONNAIRE.ACTIONS.ADD_QUESTION' | translate }}
                  </md-tooltip>
                </md-button>
                <md-button ng-click="vm.addBlock(block_2)"
                           class="md-fab md-mini md-primary"
                           aria-label="{{ 'QUESTIONNAIRE.ACTIONS.ADD_BLOCK' | translate }}">
                  <ng-md-icon icon="my_library_add"></ng-md-icon>

                  <!-- Tooltip -->
                  <md-tooltip md-direction="top">
                    {{ 'QUESTIONNAIRE.ACTIONS.ADD_BLOCK' | translate }}
                  </md-tooltip>
                </md-button>
              </section>

            </md-content>

          </md-whiteframe>

        </md-content>

        <section layout="row">
          <span flex></span>
          <md-button ng-click="vm.showAddQuestionDialog($event, block_1)"
                     class="md-fab md-mini md-primary"
                     aria-label="{{ 'QUESTIONNAIRE.ACTIONS.ADD_QUESTION' | translate }}">
            <ng-md-icon icon="playlist_add"></ng-md-icon>

            <!-- Tooltip -->
            <md-tooltip md-direction="top">
              {{ 'QUESTIONNAIRE.ACTIONS.ADD_QUESTION' | translate }}
            </md-tooltip>
          </md-button>
          <md-button ng-click="vm.addBlock(block_1)"
                     class="md-fab md-mini md-primary"
                     aria-label="{{ 'QUESTIONNAIRE.ACTIONS.ADD_BLOCK' | translate }}">
            <ng-md-icon icon="my_library_add"></ng-md-icon>

            <!-- Tooltip -->
            <md-tooltip md-direction="top">
              {{ 'QUESTIONNAIRE.ACTIONS.ADD_BLOCK' | translate }}
            </md-tooltip>
          </md-button>
        </section>

      </md-content>

    </md-whiteframe>

  </div>

  <md-button ng-click="vm.addBlock(questionnaire)" class="md-primary">
    Add block
  </md-button>

  <md-button ng-click="vm.saveQuestionnaireTemplate(questionnaire)">
    Save
  </md-button>

</md-content>

{{ questionnaire | json }}

<div ui-view></div>
